<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة متابعة أداء عقود التشغيل والصيانة</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
        body {
            background-color: #f4f7f6;
            font-family: 'Tajawal', sans-serif; /* يمكن استبدالها بخط عربي متاح أو إضافة خط خارجي */
        }
        .header {
            background-color: #004d99; /* لون أزرق داكن (يشبه ألوان القطاع العام) */
            color: white;
            padding: 20px 0;
            margin-bottom: 20px;
        }
        .kpi-card {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
            height: 100%;
        }
        .kpi-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #007bff;
        }
        .chart-container {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <header class="header text-center">
        <div class="container">
            <h1>لوحة متابعة أداء عقود التشغيل والصيانة</h1>
            <p>ملخص لمؤشرات الأداء الرئيسية (KPIs) بناءً على بيانات العقود</p>
        </div>
    </header>

    <div class="container">
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="kpi-card">
                    <p class="text-muted">متوسط نسبة الإنجاز الفعلي</p>
                    <h2 class="kpi-value text-success" id="kpi-completion">46.13%</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <p class="text-muted">متوسط نسبة المدة المنقضية</p>
                    <h2 class="kpi-value text-primary" id="kpi-elapsed">67.05%</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <p class="text-muted">إجمالي قيمة العقود (مليون ريال)</p>
                    <h2 class="kpi-value text-info" id="kpi-financial">342.07M</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <p class="text-muted">إجمالي المشاريع المتأخرة</p>
                    <h2 class="kpi-value text-danger" id="kpi-late">15</h2>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="chart-container">
                    <h5>تصنيف حالة المشاريع حسب الانحراف الزمني</h5>
                    <canvas id="deviationPieChart"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <h5>متوسط معدل الانحراف حسب المقاول</h5>
                    <canvas id="contractorBarChart"></canvas>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <h5>سجل العقود التفصيلي (مثال لصف واحد)</h5>
            <table class="table table-striped table-hover">
                <thead class="bg-light">
                    <tr>
                        <th>رقم العقد</th>
                        <th>المقاول</th>
                        <th>نسبة الإنجاز</th>
                        <th>المدة المنقضية</th>
                        <th>حالة الانحراف</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>C10250087</td>
                        <td>شركة الأمانة للمقاولات</td>
                        <td><div class="progress"><div class="progress-bar bg-warning" style="width: 46.13%">46.13%</div></div></td>
                        <td><div class="progress"><div class="progress-bar bg-info" style="width: 67.05%">67.05%</div></div></td>
                        <td class="text-danger fw-bold">متأخر عن الجدول</td>
                    </tr>
                    </tbody>
            </table>
        </div>

    </div>

    <script>
        // 1. بيانات المخطط الدائري (تصنيف حالة المشاريع)
        const deviationData = {
            labels: ['متأخر عن الجدول', 'متقدم عن الجدول', 'في الموعد المحدد'],
            datasets: [{
                data: [15, 25, 60], // مثال للعدد (15% متأخر، 25% متقدم، 60% في الموعد)
                backgroundColor: ['#dc3545', '#28a745', '#ffc107'], // أحمر، أخضر، أصفر
                hoverOffset: 4
            }]
        };

        const deviationConfig = {
            type: 'pie',
            data: deviationData,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                        rtl: true
                    }
                }
            }
        };

        new Chart(
            document.getElementById('deviationPieChart'),
            deviationConfig
        );

        // 2. بيانات المخطط العمودي (أداء المقاولين)
        const contractorData = {
            labels: ['مقاول أ', 'مقاول ب', 'مقاول ج', 'مقاول د'],
            datasets: [{
                label: 'معدل الانحراف (الإنجاز - المدة)',
                data: [-0.05, 0.10, 0.02, -0.15], // مثال لمعدلات الانحراف
                backgroundColor: (context) => {
                    const value = context.parsed.y;
                    return value < 0 ? '#dc3545' : '#28a745'; // أحمر للسالب (تأخير) وأخضر للموجب (تقدم)
                },
                borderWidth: 1
            }]
        };

        const contractorConfig = {
            type: 'bar',
            data: contractorData,
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: false,
                        title: {
                            display: true,
                            text: 'معدل الانحراف'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        };

        new Chart(
            document.getElementById('contractorBarChart'),
            contractorConfig
        );
    </script>

</body>
</html>
